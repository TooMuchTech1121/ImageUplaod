<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Camera Capture and Upload</title>
<style>
  video, img {
    max-width: 100%;
    height: auto;
  }
  #uploadBtn {
    display: none;
  }
</style>
</head>
<body>
  <h1>Camera Capture</h1>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <img id="photo" alt="Captured Photo" style="display:none;"/>
  <br />
  <button id="captureBtn">Capture</button>
  <button id="uploadBtn">Upload</button>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photo = document.getElementById('photo');
  const captureBtn = document.getElementById('captureBtn');
  const uploadBtn = document.getElementById('uploadBtn');

  // Access camera
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => {
      alert('Error accessing camera: ' + err);
    });

  captureBtn.addEventListener('click', () => {
    // Set canvas size same as video
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Get image data url
    const dataUrl = canvas.toDataURL('image/png');

    photo.src = dataUrl;
    photo.style.display = 'block';

    // Hide video and capture button
    video.style.display = 'none';
    captureBtn.style.display = 'none';

    // Show upload button
    uploadBtn.style.display = 'inline-block';
  });

  uploadBtn.addEventListener('click', () => {
    // Get image data
    const dataUrl = photo.src;

    // Prepare payload (strip the data URL prefix)
    const base64Data = dataUrl.split(',')[1];

    // Here you must replace with your backend URL that handles uploads
    const uploadUrl = 'https://script.google.com/macros/s/AKfycbzOyGMLh3_p_lU6T1t89RFQQIAknorNrnQw6rLFGjd6x1WD3Ek5uJRqOZh5FHpxQ-GqoQ/exec';

    fetch(uploadUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ imageBase64: base64Data })
    })
    .then(response => {
      if(response.ok){
        alert('Upload successful!');
        // Optionally reset UI
      } else {
        alert('Upload failed.');
      }
    })
    .catch(error => {
      alert('Upload error: ' + error);
    });
  });
</script>
</body>
</html>
